{"version":3,"file":"core-components.min.js","sources":["../packages/utils.js","../packages/core-input/core-input.js","../packages/core-input/core-input.jsx","../packages/core-dialog/core-dialog.js","../packages/core-dialog/core-dialog.jsx"],"sourcesContent":["const KEY = `core-components-${Date.now()}`\nconst STATES = {}\nlet UUID = 0\n\nexport function assign (target, ...sources) {\n  sources.filter(Boolean).forEach((source) => {\n    Object.keys(source).forEach((key) => (target[key] = source[key]))\n  })\n  return target\n}\n\nexport function attr (elements, attributes) {\n  getElements(elements).forEach((element) => {\n    Object.keys(attributes).forEach((name) => {\n      element[`${attributes[name] === null ? 'remove' : 'set'}Attribute`](name, attributes[name])\n    })\n  })\n  return elements\n}\n\nexport const closest = (element, nodeName) => {\n  for (var el = element; el; el = el.parentElement) {\n    if (el.nodeName.toLowerCase() === nodeName) return el\n  }\n}\n\nexport function getElements (elements) {\n  if (typeof elements === 'string') return getElements(document.querySelectorAll(elements))\n  if (elements && elements.length) return [].slice.call(elements)\n  if (elements && elements.nodeType) return [elements]\n  return []\n}\n\nexport function weakState (element, object, initial = {}) {\n  const weakMap = {\n    get: (element) => STATES[element[KEY]],\n    set: (element, object) => {\n      const uuid = element[KEY] || (element[KEY] = ++UUID)\n      const state = STATES[uuid] || (STATES[uuid] = initial)\n      Object.keys(object).forEach((key) => (state[key] = object[key]))\n      return state\n    },\n    has: (element) => Boolean(STATES[element[KEY]]),\n    delete: (element) => {\n      if (!weakMap.get(element)) return false\n      delete element[KEY]\n      delete STATES[element[KEY]]\n      return true\n    }\n  }\n\n  if (object === false) {\n    weakMap.delete(element)\n  } else if (typeof object === 'object') {\n    weakMap.set(element, object)\n  }\n\n  return weakMap\n}\n\nexport const queryAll = (selector, context = document) =>\n  [].slice.call(context.querySelectorAll(selector))\n","import {attr} from '../utils'\n\nconst KEY = 'input-@VERSION'\nlet LIST // Element to contain list\nlet LIVE // Element to contain screen reader text\n\nfunction render (elem) {\n  const state = elem[KEY]\n  const value = state.value.trim().toLowerCase()\n  state.hits = state.items.filter((item) => item.value.toLowerCase().indexOf(value) !== -1)\n\n  attr(LIVE, {'aria-hidden': false})\n  attr(LIST, {'hidden': state.hits.length ? null : true})\n  attr(elem, {'aria-expanded': Boolean(state.hits.length)})\n\n  LIST.style.width = `${elem.offsetWidth}px`\n  LIST.innerHTML = state.hits.map(({value}, i) =>\n    `<li role=\"option\" aria-selected=\"${i === state.index}\">${value}</li>`\n  ).join('')\n}\n\nfunction onFocus (event) {\n  const elem = event.target\n  const controls = elem.getAttribute(`data-${KEY}`)\n\n  if (controls && !elem[KEY]) {\n    const mode = elem.getAttribute(`data-${KEY}-mode`) || 'suggestions'\n    const items = [].map.call(document.querySelectorAll(`#${controls} > *`), ({value}) => ({value}))\n    const parent = elem.parentElement\n\n    attr(elem, {\n      'role': 'combobox',\n      'autocomplete': 'off',\n      'aria-controls': `${KEY}-${controls}`,\n      'aria-autocomplete': 'list',\n      'aria-haspopup': true,\n      'aria-expanded': false\n    })\n\n    parent.className = parent.className.split(' ').concat(KEY).join(' ')\n    elem[KEY] = {items, mode, list: elem.nextElementSibling} // TODO: list\n  }\n\n  if (controls) {\n    LIST.id = `${KEY}-${controls}`\n    elem.insertAdjacentElement('afterend', LIST)\n    onInput(event)\n  }\n}\n\nfunction onBlur ({target}) {\n  if (target[KEY]) {\n    attr(LIST, 'hidden', 'hidden')\n    attr(LIVE, {'aria-hidden': 'true', 'aria-live': 'polite'})\n  }\n}\n\nfunction onInput (event) {\n  const elem = event.target\n  const state = elem[KEY]\n\n  if (state) {\n    state.index = -1\n    state.value = elem.value\n    render(elem)\n    LIVE.textContent = `${state.hits.length} treff`\n  }\n}\n\nfunction onKey (event) {\n  if (event.target[KEY]) {\n    const elem = event.target\n    const state = elem[KEY]\n    if (event.keyCode === 27) onBlur(event)\n    if (event.keyCode === 38 || event.keyCode === 40) {\n      event.preventDefault()\n      const hits = [].slice.call(LIST.children)\n      const selected = hits.filter((el) => el.getAttribute('aria-selected') === 'true')[0]\n      state.index = (hits.indexOf(selected) + (event.keyCode === 38 ? -1 : 1)) % hits.length\n      LIVE.setAttribute('aria-live', 'assertive')\n\n      render(event.target)\n      const value = (state.hits[state.index] || state).value\n      if (state.mode === 'results') {\n        LIVE.textContent = value || 'Tomt tekstfelt'\n      } else {\n        elem.value = value\n      }\n    }\n  }\n}\n\nif (typeof document !== 'undefined') {\n  attr(LIST = document.createElement('ul'), {role: 'listbox'})\n  attr(LIVE = document.createElement('span'), {'aria-hidden': 'true', 'aria-live': 'polite'})\n\n  // document.head.insertAdjacentElement('afterbegin', `<style>\n  //   .core-input { background: none }\n  // </style>`)\n\n  // document.addEventListener('keydown', onKey)\n  // document.addEventListener('input', onInput)\n  // document.addEventListener('focus', onFocus, true) // Use capture to ensure event bubling\n  // document.addEventListener('blur', onBlur, true)   // Use capture to ensure event bubling\n  // document.documentElement.appendChild(LIVE)\n}\n\nexport function input () {\n  console.log('input')\n}\n","export function Input () {\n  return <div>Testing input</div>\n}\n","import {attr, getElements, weakState} from '../utils'\n\nlet BACKDROP\nconst KEY = 'dialog-@VERSION'\nconst KEY_UNIVERSAL = 'data-dialog-xxx'\nconst FOCUSABLE_ELEMENTS = `\n  [tabindex]:not([disabled]),\n  button:not([disabled]),\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled])`\n\n// Attempt to focus on an autofocus target first. If none exists we will focus\n// on the first focusable element.\nconst focusOnFirstFocusableElement = (el) => {\n  const autofocusElement = el.querySelector('[autofocus]:not([disabled])')\n  const focusableElement = el.querySelector(FOCUSABLE_ELEMENTS)\n  ;(autofocusElement || focusableElement || el).focus()\n}\n\nconst getHighestZIndex = () =>\n  getElements('*').reduce((zIndex, el) =>\n    Math.max(zIndex, Number(window.getComputedStyle(el, null).getPropertyValue('z-index')) || 0)\n  , 0)\n\nconst getActive = () => document.querySelector(`[${KEY_UNIVERSAL}]`)\n\nconst setActiveStateForElement = (el) => {\n  const prevActive = getActive()\n  prevActive && prevActive.removeAttribute(KEY_UNIVERSAL)\n  el.setAttribute(KEY_UNIVERSAL, '')\n\n  return weakState(el, {\n    prevActive,\n    focusBeforeModalOpen: document.activeElement\n  }).get(el)\n}\n\n// Will toggle the open state of the dialog depending on what the fn function\n// returns or what (Boolean) value fn has.\nconst toggle = (el, index, fn, open = true) => {\n  const isOpen = Boolean(typeof fn === 'function' ? fn(el, index) : fn) === open\n\n  attr(el, {open: isOpen ? '' : null})\n\n  if (isOpen) {\n    el.style.zIndex = getHighestZIndex() + 1\n    setActiveStateForElement(el)\n    focusOnFirstFocusableElement(el)\n    BACKDROP.hidden = false\n    // set focus\n  } else {\n    BACKDROP.hidden = !(weakState().get(el).prevActive)\n    el.removeAttribute(KEY_UNIVERSAL)\n    if (!BACKDROP.hidden) {\n      weakState().get(el).prevActive.setAttribute(KEY_UNIVERSAL, '')\n    }\n    // Should be able to pop when removing as the last element is the active dialog\n    const state = weakState().get(el)\n    // Focus on the last focused thing before the dialog modal was opened\n    state.focusBeforeModalOpen && state.focusBeforeModalOpen.focus()\n    // Delete state for element\n    weakState(el, false)\n  }\n}\n\nconst keepFocus = (event) => {\n  const activeDialog = getActive()\n  // If no dialog is active, we don't need to do anything\n  if (!activeDialog) { return }\n\n  const state = weakState().get(activeDialog)\n  const focusable = activeDialog.querySelectorAll(FOCUSABLE_ELEMENTS)\n\n  // If focus moves us outside the dialog, we need to refocus to inside the dialog\n  if (!activeDialog.contains(event.target)) {\n    state.activeElement === focusable[0] ? focusable[focusable.length - 1].focus() : focusable[0].focus()\n  } else {\n    state.activeElement = event.target\n  }\n}\n\nconst exitOnEscape = (event) => {\n  if (event.keyCode === 27) dialog(getActive()).close()\n}\n\nexport function dialog (selector, options) {\n  if (!(this instanceof dialog)) return new dialog(selector, options) //eslint-disable-line\n\n  // Initialize the element with necessary attributes for a dialog\n  this.elements = attr(getElements(selector), {\n    role: 'dialog',\n    tabindex: -1,\n    'aria-modal': true\n  })\n\n  return this\n}\n\ndialog.prototype.open = function (fn = true) {\n  this.elements.forEach((el, index) => toggle(el, index, fn))\n  return this\n}\n\ndialog.prototype.close = function (fn = false) {\n  this.elements.forEach((el, index) => toggle(el, index, fn))\n  return this\n}\n\nexport function createBackdrop () {\n  attr(BACKDROP = document.createElement('div'), {hidden: true, id: KEY})\n  // @todo: General styling. Should be removed?\n  BACKDROP.classList.add('nrk-dialog-backdrop')\n  document.addEventListener('focus', keepFocus, true)\n  document.addEventListener('keydown', exitOnEscape)\n  document.documentElement.appendChild(BACKDROP)\n}\n\nif (typeof document !== 'undefined' && !document.getElementById(KEY)) {\n  createBackdrop()\n}\n","export function Dialog () {\n  return <div>Testing dialog</div>\n}\n"],"names":["const","KEY","let"],"mappings":"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"}